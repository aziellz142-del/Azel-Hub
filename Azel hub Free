-- Da Hood Script Hub v3 - TOGGLE Silent Aim (Press Once = ON/OFF)
-- Now with: Toggle (not hold), Highlight, Tracer, Dot, Custom Keybind, "Aiming at [Name]!" notification

-- IMPORTANT: This is for educational purposes only

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Azel Hub",
   LoadingTitle = "Loading Azel Hub!",
   LoadingSubtitle = "by Azielz",
   ConfigurationSaving = { Enabled = true, FolderName = "DaHoodHubV3" },
   KeySystem = false
})

local CombatTab = Window:CreateTab("Combat")
local VisualTab = Window:CreateTab("Visuals")
local MiscTab = Window:CreateTab("Misc")

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Silent Aim Settings
getgenv().Settings = {
    Enabled = false,
    ToggleKey = Enum.KeyCode.Q,
    FOV = 120,
    Prediction = 0.165,
    TargetPart = "Head",
    TeamCheck = false,
    WallCheck = true,
    
    -- Visuals
    Highlight = true,
    Tracer = true,
    Dot = true,
    
    CurrentTarget = nil
}

-- FOV Circle
local FOVCircle = Drawing.new("Circle")
FOVCircle.Radius = getgenv().Settings.FOV
FOVCircle.Color = Color3.fromRGB(255, 0, 0)
FOVCircle.Thickness = 2
FOVCircle.Filled = false
FOVCircle.Transparency = 0.8
FOVCircle.Visible = false
FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)

-- Visuals
local TracerLine = Drawing.new("Line")
TracerLine.Visible = false
TracerLine.Color = Color3.fromRGB(255, 0, 0)
TracerLine.Thickness = 2

local HeadDot = Drawing.new("Circle")
HeadDot.Visible = false
HeadDot.Color = Color3.fromRGB(255, 0, 0)
HeadDot.Thickness = 2
HeadDot.Radius = 6
HeadDot.Filled = true

local TargetHighlight = nil

-- Notification
local NotifyGui = Instance.new("ScreenGui")
NotifyGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
NotifyGui.ResetOnSpawn = false
NotifyGui.Name = "SilentAimNotifications"
NotifyGui.IgnoreGuiInset = true

local NotifyLabel = Instance.new("TextLabel")
NotifyLabel.Size = UDim2.new(0, 400, 0, 60)
NotifyLabel.Position = UDim2.new(0.5, -200, 0, 20)
NotifyLabel.BackgroundTransparency = 0.4
NotifyLabel.BackgroundColor3 = Color3.new(0, 0, 0)
NotifyLabel.TextColor3 = Color3.new(1, 1, 1)
NotifyLabel.Font = Enum.Font.GothamBold
NotifyLabel.TextScaled = true
NotifyLabel.Text = ""
NotifyLabel.Parent = NotifyGui
Instance.new("UICorner", NotifyLabel).CornerRadius = UDim.new(0, 12)
NotifyLabel.Visible = false

local function Notify(text)
    NotifyLabel.Text = text
    NotifyLabel.Visible = true
    NotifyLabel.BackgroundTransparency = 0.4
    NotifyLabel.TextTransparency = 0
    
    task.wait(2)
    
    -- Fade out
    for i = 0.4, 1, 0.05 do
        NotifyLabel.BackgroundTransparency = i
        NotifyLabel.TextTransparency = i
        task.wait(0.03)
    end
    
    NotifyLabel.Visible = false
end

-- Get Closest Player
local function GetClosest()
    if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        return nil
    end
    
    local Closest = nil
    local Distance = getgenv().Settings.FOV
    
    for _, plr in pairs(Players:GetPlayers()) do
        if plr == LocalPlayer then continue end
        if not plr.Character then continue end
        if not plr.Character:FindFirstChild("HumanoidRootPart") then continue end
        if not plr.Character:FindFirstChild(getgenv().Settings.TargetPart) then continue end
        
        if getgenv().Settings.TeamCheck then
            if plr.Team and LocalPlayer.Team and plr.Team == LocalPlayer.Team then
                continue
            end
        end
        
        local Root = plr.Character.HumanoidRootPart
        local Part = plr.Character[getgenv().Settings.TargetPart]
        local Pos, OnScreen = Camera:WorldToViewportPoint(Part.Position)
        
        if OnScreen then
            local MousePos = Vector2.new(Mouse.X, Mouse.Y)
            local PartPos = Vector2.new(Pos.X, Pos.Y)
            local Mag = (MousePos - PartPos).Magnitude
            
            if Mag < Distance then
                if getgenv().Settings.WallCheck then
                    local RaycastParams = RaycastParams.new()
                    RaycastParams.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
                    RaycastParams.FilterType = Enum.RaycastFilterType.Blacklist
                    RaycastParams.IgnoreWater = true
                    
                    local Origin = Camera.CFrame.Position
                    local Direction = (Part.Position - Origin).Unit * 1000
                    local Result = workspace:Raycast(Origin, Direction, RaycastParams)
                    
                    if Result then
                        local HitParent = Result.Instance:FindFirstAncestorOfClass("Model")
                        if HitParent == plr.Character then
                            Closest = plr
                            Distance = Mag
                        end
                    end
                else
                    Closest = plr
                    Distance = Mag
                end
            end
        end
    end
    
    return Closest
end

-- Update Visuals
local function UpdateVisuals(plr)
    -- Highlight
    if TargetHighlight then 
        TargetHighlight:Destroy()
        TargetHighlight = nil
    end
    
    if plr and plr.Character and getgenv().Settings.Highlight then
        TargetHighlight = Instance.new("Highlight")
        TargetHighlight.FillColor = Color3.fromRGB(255, 0, 0)
        TargetHighlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        TargetHighlight.FillTransparency = 0.3
        TargetHighlight.OutlineTransparency = 0
        TargetHighlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        TargetHighlight.Parent = plr.Character
    end
    
    -- Tracer
    if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and getgenv().Settings.Tracer then
        local RootPos, OnScreen = Camera:WorldToViewportPoint(plr.Character.HumanoidRootPart.Position)
        if OnScreen then
            TracerLine.From = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y)
            TracerLine.To = Vector2.new(RootPos.X, RootPos.Y)
            TracerLine.Visible = true
        else
            TracerLine.Visible = false
        end
    else
        TracerLine.Visible = false
    end
    
    -- Dot
    if plr and plr.Character and plr.Character:FindFirstChild("Head") and getgenv().Settings.Dot then
        local HeadPos, OnScreen = Camera:WorldToViewportPoint(plr.Character.Head.Position)
        if OnScreen then
            HeadDot.Position = Vector2.new(HeadPos.X, HeadPos.Y)
            HeadDot.Visible = true
        else
            HeadDot.Visible = false
        end
    else
        HeadDot.Visible = false
    end
end

-- Hook mouse for Silent Aim
local function HookMouse()
    local OldMouseHit
    local OldMouseTarget
    
    -- Store original mouse functions
    local MouseMeta = getrawmetatable(Mouse)
    local OldIndex = MouseMeta.__index
    local OldNewIndex = MouseMeta.__newindex
    
    setreadonly(MouseMeta, false)
    
    MouseMeta.__index = newcclosure(function(self, key)
        if getgenv().Settings.Enabled then
            local Target = GetClosest()
            
            if key == "Hit" and Target and Target.Character then
                local Part = Target.Character:FindFirstChild(getgenv().Settings.TargetPart) or Target.Character.HumanoidRootPart
                local Predicted = Part.Position + (Part.AssemblyLinearVelocity * getgenv().Settings.Prediction)
                
                if Target ~= getgenv().Settings.CurrentTarget then
                    getgenv().Settings.CurrentTarget = Target
                    spawn(function() 
                        Notify("Aiming at " .. (Target.DisplayName or Target.Name) .. "!") 
                    end)
                end
                
                UpdateVisuals(Target)
                return CFrame.new(Predicted)
                
            elseif key == "Target" and Target and Target.Character then
                local Part = Target.Character:FindFirstChild(getgenv().Settings.TargetPart) or Target.Character.HumanoidRootPart
                UpdateVisuals(Target)
                return Part
            end
        end
        
        if not getgenv().Settings.Enabled then
            UpdateVisuals(nil)
            getgenv().Settings.CurrentTarget = nil
        end
        
        return OldIndex(self, key)
    end)
    
    setreadonly(MouseMeta, true)
end

-- Initialize the hook
HookMouse()

-- FOV & Visual Update Loop
RunService.Heartbeat:Connect(function()
    if Mouse then
        FOVCircle.Position = Vector2.new(Mouse.X, Mouse.Y)
    end
    FOVCircle.Radius = getgenv().Settings.FOV
    FOVCircle.Visible = getgenv().Settings.Enabled
    
    if getgenv().Settings.Enabled then
        local Target = GetClosest()
        if Target then
            UpdateVisuals(Target)
        else
            UpdateVisuals(nil)
        end
    else
        UpdateVisuals(nil)
        getgenv().Settings.CurrentTarget = nil
    end
end)

-- Toggle Keybind Detection
UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == getgenv().Settings.ToggleKey then
        getgenv().Settings.Enabled = not getgenv().Settings.Enabled
        FOVCircle.Visible = getgenv().Settings.Enabled
        Notify(getgenv().Settings.Enabled and "Silent Aim: ON" or "Silent Aim: OFF")
        
        if not getgenv().Settings.Enabled then
            UpdateVisuals(nil)
            getgenv().Settings.CurrentTarget = nil
        end
    end
end)

-- GUI Controls
CombatTab:CreateToggle({
    Name = "Silent Aim (Toggle)",
    CurrentValue = false,
    Callback = function(v)
        getgenv().Settings.Enabled = v
        FOVCircle.Visible = v
        Notify(v and "Silent Aim: ON" or "Silent Aim: OFF")
        
        if not v then
            UpdateVisuals(nil)
            getgenv().Settings.CurrentTarget = nil
        end
    end
})

CombatTab:CreateDropdown({
    Name = "Toggle Keybind",
    Options = {"Q","E","T","G","V","C","X","Z","F"},
    CurrentOption = "Q",
    Callback = function(opt)
        getgenv().Settings.ToggleKey = Enum.KeyCode[opt]
        Notify("Keybind set to " .. opt)
    end
})

CombatTab:CreateSlider({
    Name = "FOV",
    Range = {10, 500},
    Increment = 10,
    CurrentValue = 120,
    Callback = function(v) 
        getgenv().Settings.FOV = v
        FOVCircle.Radius = v
    end
})

CombatTab:CreateSlider({
    Name = "Prediction",
    Range = {0, 1},
    Increment = 0.001,
    CurrentValue = 0.165,
    Callback = function(v) getgenv().Settings.Prediction = v end
})

CombatTab:CreateDropdown({
    Name = "Target Part",
    Options = {"Head", "HumanoidRootPart", "UpperTorso", "LowerTorso"},
    CurrentOption = "Head",
    Callback = function(v) getgenv().Settings.TargetPart = v end
})

CombatTab:CreateToggle({
    Name="Team Check", 
    CurrentValue = false,
    Callback=function(v) 
        getgenv().Settings.TeamCheck = v 
    end
})

CombatTab:CreateToggle({
    Name="Wall Check", 
    CurrentValue=true, 
    Callback=function(v) 
        getgenv().Settings.WallCheck = v 
    end
})

-- Visuals Tab
VisualTab:CreateToggle({
    Name="Highlight Target", 
    CurrentValue=true, 
    Callback=function(v) 
        getgenv().Settings.Highlight = v 
        if not v and TargetHighlight then
            TargetHighlight:Destroy()
            TargetHighlight = nil
        end
    end
})

VisualTab:CreateToggle({
    Name="Tracer", 
    CurrentValue=true, 
    Callback=function(v) 
        getgenv().Settings.Tracer = v 
        if not v then
            TracerLine.Visible = false
        end
    end
})

VisualTab:CreateToggle({
    Name="Head Dot", 
    CurrentValue=true, 
    Callback=function(v) 
        getgenv().Settings.Dot = v 
        if not v then
            HeadDot.Visible = false
        end
    end
})

-- Clean up on script termination
game:GetService("Players").PlayerRemoving:Connect(function(player)
    if player == LocalPlayer then
        if FOVCircle then FOVCircle:Remove() end
        if TracerLine then TracerLine:Remove() end
        if HeadDot then HeadDot:Remove() end
        if TargetHighlight then TargetHighlight:Destroy() end
        if NotifyGui then NotifyGui:Destroy() end
    end
end)

print("Da Hood Toggle Silent Aim Hub Loaded!")
print("Press your keybind once to toggle Silent Aim ON/OFF")
